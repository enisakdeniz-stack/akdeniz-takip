<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Akdeniz Takip</title>

    <link rel="apple-touch-icon" href="https://i.ibb.co/Y7LRMkr3/1-A468574-4-AFF-42-EA-81-EA-7756-D9017-D56.png">
    <link rel="shortcut icon" href="https://i.ibb.co/Y7LRMkr3/1-A468574-4-AFF-42-EA-81-EA-7756-D9017-D56.png">

    <meta name="apple-mobile-web-app-title" content="Akdeniz Takip">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        .safe-pt { padding-top: env(safe-area-inset-top); }
        .safe-pb { padding-bottom: env(safe-area-inset-bottom); }

        /* FİŞ YAZDIRMA STİLİ */
        @media print {
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 20px; background: white; color: black; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const { useState, useEffect, useMemo } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyDb--JGJG7gdHcAXXGtvwT9FmrRnxjvCvo",
            authDomain: "cnc-takip-460b6.firebaseapp.com",
            projectId: "cnc-takip-460b6",
            storageBucket: "cnc-takip-460b6.firebasestorage.app",
            messagingSenderId: "cnc-takip-460b6.firebasestorage.app",
            appId: "1:627287710354:web:4b04d452c51ac793bda44b"
        };

        let app, db, dbError = null;
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
        } catch (e) {
            console.error(e);
            dbError = e.message;
        }

        const LOGO_LINKI = "https://i.ibb.co/Y7LRMkr3/1-A468574-4-AFF-42-EA-81-EA-7756-D9017-D56.png"; 

        // ICONS
        const Icon = (p) => React.createElement("svg", {...p, xmlns:"http://www.w3.org/2000/svg", width:"24", height:"24", viewBox:"0 0 24 24", fill:"none", stroke:"currentColor", strokeWidth:"2", strokeLinecap:"round", strokeLinejoin:"round"});
        const IconSave = () => Icon({children: [React.createElement("path", {d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}), React.createElement("polyline", {points:"17 21 17 13 7 13 7 21"}), React.createElement("polyline", {points:"7 3 7 8 15 8"})]});
        const IconFlag = () => Icon({className:"text-red-600 fill-red-100", children: [React.createElement("path", {d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"}), React.createElement("line", {x1:"4", x2:"4", y1:"22", y2:"15"})]});
        const IconClose = () => Icon({children: [React.createElement("path", {d:"M18 6 6 18"}), React.createElement("path", {d:"m6 6 12 12"})]});
        const IconCheck = () => Icon({children: [React.createElement("polyline", {points:"20 6 9 17 4 12"})]});
        const IconEdit = () => Icon({width:14, height:14, children: [React.createElement("path", {d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})]});
        const IconTrash = () => Icon({className:"text-red-500", children: [React.createElement("path", {d:"M3 6h18"}), React.createElement("path", {d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}), React.createElement("path", {d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})]});
        const IconAlert = () => Icon({className:"text-yellow-500 mx-auto mb-2", width:48, height:48, children: [React.createElement("path", {d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}), React.createElement("line", {x1:"12", y1:"9", x2:"12", y2:"13"}), React.createElement("line", {x1:"12", y1:"17", x2:"12.01", y2:"17"})]});
        
        const IconSearch = () => React.createElement("svg", {xmlns:"http://www.w3.org/2000/svg", width:"20", height:"20", viewBox:"0 0 24 24", fill:"none", stroke:"currentColor", strokeWidth:"2", strokeLinecap:"round", strokeLinejoin:"round", className:"text-gray-400"}, React.createElement("circle", {cx:"11", cy:"11", r:"8"}), React.createElement("line", {x1:"21", x2:"16.65", y1:"21", y2:"16.65"}));
        const IconPrinter = () => React.createElement("svg", {xmlns:"http://www.w3.org/2000/svg", width:"18", height:"18", viewBox:"0 0 24 24", fill:"none", stroke:"currentColor", strokeWidth:"2", strokeLinecap:"round", strokeLinejoin:"round", className:"text-blue-500"}, React.createElement("polyline", {points:"6 9 6 2 18 2 18 9"}), React.createElement("path", {d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}), React.createElement("rect", {width:"12", height:"8", x:"6", y:"14"}));
        const IconChart = () => React.createElement("svg", {xmlns:"http://www.w3.org/2000/svg", width:"20", height:"20", viewBox:"0 0 24 24", fill:"none", stroke:"currentColor", strokeWidth:"2", strokeLinecap:"round", strokeLinejoin:"round"}, React.createElement("path", {d:"M18 20V10"}), React.createElement("path", {d:"M12 20V4"}), React.createElement("path", {d:"M6 20v-6"}));

        function App() {
            if (dbError) return React.createElement("div", {className: "p-10 text-red-600 font-bold"}, "Hata: " + dbError);

            const MACHINES = [
                { id: 'T5', name: 'Makina T5', color: 'bg-orange-600', text:'text-orange-600', bg:'bg-orange-50' },
                { id: 'A25', name: 'Makina A25', color: 'bg-blue-600', text:'text-blue-600', bg:'bg-blue-50' },
                { id: 'A32', name: 'Makina A32', color: 'bg-emerald-600', text:'text-emerald-600', bg:'bg-emerald-50' }
            ];

            const [activeTab, setActiveTab] = useState('entry');
            const [isLoading, setIsLoading] = useState(true);
            const [showToast, setShowToast] = useState(false);

            // STATE - CNC
            const [activeMachine, setActiveMachine] = useState(MACHINES[0].id);
            const [partName, setPartName] = useState('');
            const [inputCounter, setInputCounter] = useState('');
            const [selectedHistoryDate, setSelectedHistoryDate] = useState(new Date().toISOString().split('T')[0]);
            const [editLog, setEditLog] = useState(null);
            const [showEditModal, setShowEditModal] = useState(false);
            const [logs, setLogs] = useState([]);
            const [batchResets, setBatchResets] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [modalType, setModalType] = useState(null);
            const [modalData, setModalData] = useState({});

            // STATE - SATIŞ
            const [salesDate, setSalesDate] = useState(new Date().toISOString().split('T')[0]);
            const [customer, setCustomer] = useState('');
            const [product, setProduct] = useState('');
            const [count, setCount] = useState('');
            const [price, setPrice] = useState('');
            const [taxIncluded, setTaxIncluded] = useState(false);
            const [cart, setCart] = useState([]);
            const [sales, setSales] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [productSearchTerm, setProductSearchTerm] = useState(''); // YENİ: Ürün Arama
            const [editingSale, setEditingSale] = useState(null);
            const [printSale, setPrintSale] = useState(null);
            const [isSalesFormOpen, setIsSalesFormOpen] = useState(false);
            const [showReportModal, setShowReportModal] = useState(false);

            useEffect(() => {
                if (!db) return;
                const unsubLogs = onSnapshot(query(collection(db, "logs"), orderBy("timestamp", "desc")), (snapshot) => {
                    setLogs(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    setIsLoading(false);
                });
                const unsubResets = onSnapshot(query(collection(db, "resets"), orderBy("resetDate", "desc")), (snapshot) => {
                    setBatchResets(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });
                const unsubSales = onSnapshot(query(collection(db, "sales_demo"), orderBy("timestamp", "desc")), (snapshot) => {
                    setSales(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });
                return () => { unsubLogs(); unsubResets(); unsubSales(); };
            }, []);

            // --- CNC HESAPLAMALAR ---
            const uniqueProducts = useMemo(() => Array.from(new Set(logs.map(l => l.partName))).sort(), [logs]);
            
            const latestReset = useMemo(() => {
                if(!partName) return null;
                const pName = partName.toUpperCase().trim();
                const pResets = batchResets.filter(r => r.partName === pName);
                if(pResets.length === 0) return null;
                return pResets[0];
            }, [batchResets, partName]);

            const lastRecord = useMemo(() => {
                if(!partName) return null;
                const pName = partName.toUpperCase().trim();
                let relevantLogs = logs.filter(l => l.partName === pName && l.machineId === activeMachine && l.totalCounter !== undefined);
                if (latestReset) relevantLogs = relevantLogs.filter(l => new Date(l.timestamp) > new Date(latestReset.resetDate));
                return relevantLogs.length > 0 ? relevantLogs[0] : null; 
            }, [logs, latestReset, partName, activeMachine]);

            const lastCounterValue = lastRecord ? lastRecord.totalCounter : 0;
            const isFirstRecordOfBatch = !lastRecord;

            const stats = useMemo(() => {
                if (!partName) return { daily: 0, batch: 0, yearly: 0 };
                const pNameUpper = partName.toUpperCase().trim();
                const now = new Date();
                const todayStr = now.toISOString().split('T')[0];
                const resets = batchResets.filter(r => r.partName === pNameUpper).sort((a,b) => new Date(b.resetDate) - new Date(a.resetDate));
                const lastReset = resets.length ? new Date(resets[0].resetDate) : new Date(0);
                let s = { daily: 0, batch: 0, yearly: 0 };
                logs.forEach(l => {
                    if (l.partName === pNameUpper) {
                        if (new Date(l.date).getFullYear() === now.getFullYear()) s.yearly += l.count;
                        if (l.date === todayStr) s.daily += l.count;
                        if (new Date(l.timestamp) > lastReset) s.batch += l.count;
                    }
                });
                return s;
            }, [logs, batchResets, partName]);

            const yesterdaySummary = useMemo(() => {
                const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toISOString().split('T')[0];
                const filteredLogs = logs.filter(l => l.date === yesterdayStr);
                const summary = filteredLogs.reduce((acc, log) => {
                    const key = `${log.machineId}-${log.partName}`;
                    if (!acc[key]) acc[key] = { machineId: log.machineId, partName: log.partName, totalProduction: 0, lastCounter: 0, timestamp: log.timestamp, isFinished: false, machineColor: MACHINES.find(m => m.id === log.machineId)?.color || 'bg-gray-500' };
                    acc[key].totalProduction += log.count;
                    if (new Date(log.timestamp) >= new Date(acc[key].timestamp)) {
                        acc[key].lastCounter = log.totalCounter; acc[key].timestamp = log.timestamp;
                        if (log.type === 'finish') acc[key].isFinished = true;
                    }
                    return acc;
                }, {});
                return Object.values(summary);
            }, [logs, MACHINES]);

            // --- SATIŞ İSTATİSTİKLERİ VE FİLTRELEME (GÜNCELLENDİ) ---
            const filteredSales = useMemo(() => {
                let result = sales;
                if (searchTerm) {
                    result = result.filter(s => s.customer.includes(searchTerm.toUpperCase()));
                }
                if (productSearchTerm) {
                    result = result.filter(s => s.items && s.items.some(i => i.product.includes(productSearchTerm.toUpperCase())));
                }
                
                // Hiç arama yoksa son 10, varsa hepsi
                if (!searchTerm && !productSearchTerm) return result.slice(0, 10);
                return result;
            }, [sales, searchTerm, productSearchTerm]);

            const uniqueCustomers = useMemo(() => [...new Set(sales.map(s => s.customer))].sort(), [sales]);
            const uniqueSalesProducts = useMemo(() => [...new Set(sales.flatMap(s => s.items || []).map(i => i.product))].sort(), [sales]);

            const salesStats = useMemo(() => {
                const now = new Date();
                let monthlyTotal = 0;
                let yearlyTotal = 0;
                let monthlyCount = 0;

                sales.forEach(s => {
                    const d = new Date(s.date);
                    if (d.getFullYear() === now.getFullYear()) {
                        yearlyTotal += s.grandTotal;
                        if (d.getMonth() === now.getMonth()) {
                            monthlyTotal += s.grandTotal;
                            monthlyCount++;
                        }
                    }
                });
                return { monthlyTotal, yearlyTotal, monthlyCount };
            }, [sales]);

            const reportData = useMemo(() => {
                const productStats = {};
                const customerStats = {};
                const currentYear = new Date().getFullYear();

                sales.forEach(s => {
                    if (new Date(s.date).getFullYear() === currentYear) {
                        if (!customerStats[s.customer]) customerStats[s.customer] = 0;
                        customerStats[s.customer] += s.grandTotal;

                        if (s.items) {
                            s.items.forEach(item => {
                                if (!productStats[item.product]) productStats[item.product] = 0;
                                productStats[item.product] += item.count;
                            });
                        }
                    }
                });
                const sortedProducts = Object.entries(productStats).sort((a,b) => b[1] - a[1]);
                const sortedCustomers = Object.entries(customerStats).sort((a,b) => b[1] - a[1]);
                return { sortedProducts, sortedCustomers };
            }, [sales]);

            const mConfig = MACHINES.find(m => m.id === activeMachine) || MACHINES[0];

            // --- AKSİYONLAR (CNC) ---
            const handleSaveClick = () => { if(!partName || !inputCounter) return alert("Eksik bilgi!"); const current = parseInt(inputCounter); if(isNaN(current)) return alert("Geçersiz sayı"); if (isFirstRecordOfBatch && current > 0) { setModalType('initial_ask'); setModalData({ current }); setShowModal(true); return; } let production = current - lastCounterValue; if(production < 0) production = 0; setModalType('save'); setModalData({ current, production, prev: lastCounterValue }); setShowModal(true); };
            const handleFinishClick = () => { if(!partName || !inputCounter) return alert("Eksik bilgi!"); const current = parseInt(inputCounter); let production = current - lastCounterValue; if(isFirstRecordOfBatch && current > 0) { setModalType('finish_initial'); setModalData({ current }); setShowModal(true); return; } setModalType('finish'); setModalData({ current, production, prev: lastCounterValue }); setShowModal(true); };
            const executeSave = async (isInitial) => { setShowModal(false); try { const current = parseInt(inputCounter); let production = (isInitial || modalType === 'initial_ask') ? (modalType === 'initial_ask' && !isInitial ? current : 0) : current - lastCounterValue; if(production < 0) production = 0; await addDoc(collection(db, "logs"), { machineId: activeMachine, partName: partName.toUpperCase().trim(), count: production, totalCounter: current, date: new Date().toISOString().split('T')[0], timestamp: new Date().toISOString() }); setInputCounter(''); setShowToast(true); setTimeout(()=>setShowToast(false), 2000); } catch(e) { alert("Hata: " + e.message); } };
            const executeFinish = async (isInitial) => { setShowModal(false); try { const current = parseInt(inputCounter); let production = (isInitial || modalType === 'finish_initial') ? (modalType === 'finish_initial' && !isInitial ? current : 0) : current - lastCounterValue; if(production < 0) production = 0; if (production > 0 || isInitial) { await addDoc(collection(db, "logs"), { machineId: activeMachine, partName: partName.toUpperCase().trim(), count: production, totalCounter: current, type: 'finish', date: new Date().toISOString().split('T')[0], timestamp: new Date().toISOString() }); } setTimeout(async () => { await addDoc(collection(db, "resets"), { partName: partName.toUpperCase().trim(), resetDate: new Date().toISOString() }); setInputCounter(''); alert("Parti Kapatıldı."); }, 500); } catch(e) { alert("Hata: " + e.message); } };
            const handleEditSave = async () => { if(!editLog) return; try { await updateDoc(doc(db, "logs", editLog.id), { machineId: editLog.machineId, count: parseInt(editLog.count), totalCounter: editLog.totalCounter ? parseInt(editLog.totalCounter) : null, date: editLog.date, partName: editLog.partName.toUpperCase(), type: editLog.type }); setShowEditModal(false); setEditLog(null); alert("Güncellendi."); } catch (e) { alert("Hata: " + e.message); } };
            const executeDelete = async () => { setShowModal(false); if(editLog) { await deleteDoc(doc(db, "logs", editLog.id)); setEditLog(null); setShowEditModal(false); } };

            // --- AKSİYONLAR (SATIŞ) ---
            const handleAddToCart = () => { if (!product || !count || !price) return alert("Eksik bilgi!"); const numCount = parseFloat(count); const numPrice = parseFloat(price); const subTotal = numCount * numPrice; const tax = taxIncluded ? subTotal * 0.20 : 0; setCart([...cart, { id: Date.now(), product: product.toUpperCase(), count: numCount, price: numPrice, taxIncluded, total: subTotal + tax }]); setProduct(''); setCount(''); setPrice(''); };
            const handleSaveSale = async () => { if (!customer) return alert("Müşteri adı girin."); if (cart.length === 0) return alert("Sepet boş."); try { await addDoc(collection(db, "sales_demo"), { date: salesDate, customer: customer.toUpperCase(), items: cart, grandTotal: cart.reduce((acc, i) => acc + i.total, 0), timestamp: new Date().toISOString() }); setCart([]); setCustomer(''); setIsSalesFormOpen(false); alert("Satış Kaydedildi!"); } catch (e) { alert("Hata: " + e.message); } };
            const handlePrint = (sale) => { setPrintSale(sale); setTimeout(() => window.print(), 300); };
            const handleDeleteSale = async (id) => { if(confirm("Silinsin mi?")) { await deleteDoc(doc(db, "sales_demo", id)); setEditingSale(null); } };

            const PrintTemplate = () => {
                if (!printSale) return null;
                return React.createElement("div", {id: "print-area", className: "hidden"},
                    React.createElement("div", {className: "border-b-2 border-black pb-4 mb-4"}, React.createElement("h1", {className: "text-2xl font-bold"}, "AKDENİZ MAKİNA CNC"), React.createElement("p", {className: "text-sm"}, "Tel: 0555 555 55 55 | İzmir"), React.createElement("h2", {className: "text-xl font-bold mt-4 text-center"}, "TESLİM FİŞİ / FATURA")),
                    React.createElement("div", {className: "flex justify-between mb-6"}, React.createElement("div", {}, React.createElement("strong", {}, "SAYIN: "), printSale.customer, React.createElement("br"), React.createElement("span", {}, "Tarih: " + new Date(printSale.date).toLocaleDateString('tr-TR'))), React.createElement("div", {className: "text-right"}, React.createElement("strong", {}, "Fiş No: "), printSale.timestamp.slice(-6))),
                    React.createElement("table", {className: "w-full border-collapse border border-black mb-6"}, React.createElement("thead", {}, React.createElement("tr", {className: "bg-gray-200"}, React.createElement("th", {className: "border border-black p-2 text-left"}, "Ürün"), React.createElement("th", {className: "border border-black p-2 text-center"}, "Miktar"), React.createElement("th", {className: "border border-black p-2 text-right"}, "Fiyat"), React.createElement("th", {className: "border border-black p-2 text-right"}, "Tutar"))), React.createElement("tbody", {}, (printSale.items || []).map((item, i) => React.createElement("tr", {key: i}, React.createElement("td", {className: "border border-black p-2"}, item.product), React.createElement("td", {className: "border border-black p-2 text-center"}, item.count), React.createElement("td", {className: "border border-black p-2 text-right"}, item.price.toLocaleString('tr-TR') + " ₺"), React.createElement("td", {className: "border border-black p-2 text-right"}, item.total.toLocaleString('tr-TR') + " ₺"))))),
                    React.createElement("div", {className: "text-right text-xl font-bold"}, "TOPLAM: ", printSale.grandTotal.toLocaleString('tr-TR', {style:'currency', currency:'TRY'}))
                );
            };

            return React.createElement("div", {className: "min-h-screen pb-20 font-sans safe-pt bg-slate-50 relative"},
                React.createElement(PrintTemplate),
                showToast && React.createElement("div", {className: "fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-emerald-500 text-white px-6 py-3 rounded-full shadow-lg flex items-center gap-2"}, React.createElement(IconCheck), "Kaydedildi"),
                
                // ... (CNC MODALLARI AYNEN KORUNDU) ...
                showModal && React.createElement("div", {className: "fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 no-print"}, React.createElement("div", {className: "bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl text-center"}, (modalType === 'initial_ask' || modalType === 'finish_initial') && React.createElement("div", {}, React.createElement(IconAlert), React.createElement("h3", {className: "font-bold mb-2"}, "İlk Giriş"), React.createElement("p", {className: "mb-4"}, `Girdiğin ${modalData.current} sayısı Başlangıç mı, Üretim mi?`), React.createElement("button", {onClick: ()=>modalType==='finish_initial'?executeFinish(true):executeSave(true), className: "w-full py-3 bg-yellow-100 rounded-xl font-bold mb-2"}, "BAŞLANGIÇ (Üretim=0)"), React.createElement("button", {onClick: ()=>modalType==='finish_initial'?executeFinish(false):executeSave(false), className: "w-full py-3 bg-blue-600 text-white rounded-xl font-bold"}, "ÜRETİM")), (modalType === 'save' || modalType === 'finish') && React.createElement("div", {}, modalType === 'finish' ? React.createElement(IconFlag) : React.createElement(IconCheck), React.createElement("h3", {className: "font-bold mb-2"}, modalType === 'finish' ? "Partiyi Bitir" : "Kaydet"), React.createElement("div", {className: "text-left bg-slate-100 p-4 rounded-xl mb-4"}, React.createElement("div", {}, `Eski Sayaç: ${modalData.prev}`), React.createElement("div", {}, `Yeni Sayaç: ${modalData.current}`), React.createElement("div", {className:"text-green-600 font-bold"}, `Üretim: +${modalData.production}`)), React.createElement("div", {className: "flex gap-2"}, React.createElement("button", {onClick: ()=>setShowModal(false), className: "flex-1 py-3 bg-slate-200 rounded-xl"}, "İptal"), React.createElement("button", {onClick: ()=>modalType==='finish'?executeFinish(false):executeSave(false), className: `flex-1 py-3 text-white rounded-xl font-bold ${modalType==='finish'?'bg-red-600':'bg-blue-600'}`}, "ONAYLA"))), modalType === 'delete' && React.createElement("div", {}, React.createElement(IconTrash), React.createElement("h3", {className:"font-bold mb-2"}, "Sil"), React.createElement("p", {className:"mb-4"}, "Emin misin?"), React.createElement("button", {onClick: executeDelete, className: "w-full py-3 bg-red-600 text-white rounded-xl font-bold"}, "SİL")))),
                showEditModal && editLog && React.createElement("div", {className: "fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 no-print"}, React.createElement("div", {className: "bg-white w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden"}, React.createElement("div", {className: "bg-slate-100 p-4 border-b flex justify-between items-center"}, React.createElement("h3", {className: "font-bold"}, "Kaydı Düzenle"), React.createElement("button", {onClick: () => setShowEditModal(false)}, React.createElement(IconClose))), React.createElement("div", {className: "p-6 space-y-4"}, React.createElement("div", {}, React.createElement("label", {className: "text-xs font-bold text-gray-400"}, "MAKİNE"), React.createElement("div", {className: "grid grid-cols-3 gap-2 mt-1"}, MACHINES.map(m => React.createElement("button", {key: m.id, onClick: () => setEditLog({...editLog, machineId: m.id}), className: `p-2 rounded-lg text-xs font-bold border ${editLog.machineId === m.id ? 'bg-slate-800 text-white border-slate-800' : 'bg-white text-gray-500 border-gray-200'}`}, m.id)))), React.createElement("div", {}, React.createElement("label", {className: "text-xs font-bold text-gray-400"}, "MAKİNE SAYACI (Total)"), React.createElement("input", {type: "number", value: editLog.totalCounter || '', onChange: (e) => setEditLog({...editLog, totalCounter: e.target.value}), className: "w-full p-3 border rounded-xl font-bold text-lg bg-yellow-50"})), React.createElement("div", {}, React.createElement("label", {className: "text-xs font-bold text-gray-400"}, "ÜRETİM (Fark)"), React.createElement("input", {type: "number", value: editLog.count, onChange: (e) => setEditLog({...editLog, count: e.target.value}), className: "w-full p-3 border rounded-xl font-bold text-lg"})), React.createElement("div", {}, React.createElement("label", {className: "text-xs font-bold text-gray-400"}, "TARİH"), React.createElement("input", {type: "date", value: editLog.date, onChange: (e) => setEditLog({...editLog, date: e.target.value}), className: "w-full p-3 border rounded-xl"})), React.createElement("div", {className: "flex items-center gap-3 p-3 bg-red-50 rounded-xl border border-red-100"}, React.createElement("input", {type: "checkbox", checked: editLog.type === 'finish', onChange: (e) => setEditLog({...editLog, type: e.target.checked ? 'finish' : null}), className: "w-5 h-5 accent-red-600"}), React.createElement("label", {className: "text-sm font-bold text-red-700"}, "Bu Bitiş Kaydıdır (Bayrak Ekle)"))), React.createElement("div", {className: "p-4 bg-slate-50 border-t flex gap-3"}, React.createElement("button", {onClick: ()=>setModalType('delete')||setShowModal(true), className: "flex-1 py-3 bg-red-100 text-red-600 rounded-xl font-bold"}, "SİL"), React.createElement("button", {onClick: handleEditSave, className: "flex-[2] py-3 bg-blue-600 text-white rounded-xl font-bold"}, "GÜNCELLE")))),
                editingSale && React.createElement("div", {className: "fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 no-print"}, React.createElement("div", {className: "bg-white w-full max-w-sm rounded-2xl shadow-2xl p-5"}, React.createElement("div", {className: "flex justify-between items-center mb-4 border-b pb-2"}, React.createElement("h3", {className: "font-bold text-lg"}, "Satış Detayı"), React.createElement("button", {onClick: ()=>setEditingSale(null), className: "p-2 bg-slate-100 rounded-full"}, React.createElement(IconClose))), React.createElement("div", {className: "space-y-2 mb-6 max-h-60 overflow-y-auto"}, (editingSale.items || []).map((item, idx) => React.createElement("div", {key: idx, className: "flex justify-between text-sm border-b border-slate-50 py-1"}, React.createElement("span", {}, item.product + " (" + item.count + "x" + item.price + ")"), React.createElement("span", {className: "font-bold"}, item.total.toLocaleString('tr-TR') + "₺")))), React.createElement("div", {className: "flex gap-3"}, React.createElement("button", {onClick: ()=>handleDeleteSale(editingSale.id), className: "flex-1 py-3 bg-red-50 text-red-600 rounded-xl font-bold flex justify-center items-center gap-2"}, React.createElement(IconTrash), " SİL"), React.createElement("button", {onClick: ()=>handlePrint(editingSale), className: "flex-[2] py-3 bg-blue-600 text-white rounded-xl font-bold flex justify-center items-center gap-2"}, React.createElement(IconPrinter), " YAZDIR")))),

                // RAPOR MODAL (İSTATİSTİKLER BURAYA TAŞINDI)
                showReportModal && React.createElement("div", {className: "fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 no-print"},
                    React.createElement("div", {className: "bg-white w-full max-w-sm rounded-2xl shadow-2xl p-5 overflow-hidden flex flex-col max-h-[90vh]"},
                        React.createElement("div", {className: "flex justify-between items-center mb-4 border-b pb-2"}, React.createElement("h3", {className: "font-bold text-lg"}, "Yönetim Raporu"), React.createElement("button", {onClick: ()=>setShowReportModal(false), className: "p-2 bg-slate-100 rounded-full"}, React.createElement(IconClose))),
                        React.createElement("div", {className: "overflow-y-auto flex-1 pr-2 space-y-6"},
                            // CİRO KARTLARI BURAYA GELDİ
                            React.createElement("div", {className: "grid grid-cols-2 gap-3 mb-2"},
                                React.createElement("div", {className: "bg-purple-50 p-3 rounded-xl border border-purple-100"}, 
                                    React.createElement("div", {className: "text-[10px] font-bold text-slate-500"}, "BU AY CİRO"),
                                    React.createElement("div", {className: "text-lg font-black text-purple-700"}, salesStats.monthlyTotal.toLocaleString('tr-TR', {maximumFractionDigits:0}) + "₺")
                                ),
                                React.createElement("div", {className: "bg-blue-50 p-3 rounded-xl border border-blue-100"}, 
                                    React.createElement("div", {className: "text-[10px] font-bold text-slate-500"}, "BU YIL CİRO"),
                                    React.createElement("div", {className: "text-lg font-black text-slate-700"}, salesStats.yearlyTotal.toLocaleString('tr-TR', {maximumFractionDigits:0}) + "₺")
                                )
                            ),
                            React.createElement("div", {},
                                React.createElement("h4", {className: "text-xs font-bold text-purple-700 uppercase mb-2"}, "En Çok Satan Ürünler (Bu Yıl)"),
                                reportData.sortedProducts.length === 0 ? React.createElement("div", {className: "text-gray-400 text-sm"}, "Veri yok") : 
                                reportData.sortedProducts.map(([name, qty], i) => React.createElement("div", {key: i, className: "flex justify-between text-sm py-1 border-b border-slate-50"}, React.createElement("span", {}, name), React.createElement("span", {className: "font-bold"}, qty + " Adet")))
                            ),
                            React.createElement("div", {},
                                React.createElement("h4", {className: "text-xs font-bold text-purple-700 uppercase mb-2"}, "Müşteri Ciroları (Bu Yıl)"),
                                reportData.sortedCustomers.length === 0 ? React.createElement("div", {className: "text-gray-400 text-sm"}, "Veri yok") : 
                                reportData.sortedCustomers.map(([name, total], i) => React.createElement("div", {key: i, className: "flex justify-between text-sm py-1 border-b border-slate-50"}, React.createElement("span", {}, name), React.createElement("span", {className: "font-bold"}, total.toLocaleString('tr-TR') + " ₺")))
                            )
                        )
                    )
                ),

                // HEADER (BAŞLIK GÜNCELLENDİ)
                React.createElement("div", {className: "bg-slate-900 text-white p-4 flex justify-between items-center sticky top-0 z-10 no-print"},
                    React.createElement("h1", {className: "font-bold flex gap-2 items-center"}, React.createElement("img", {src: LOGO_LINKI, className: "w-8 h-8 rounded-full bg-white"}), " Akdeniz Takip "),
                    React.createElement("div", {className: "bg-slate-800 rounded p-1 flex gap-1"},
                        React.createElement("button", {onClick: ()=>setActiveTab('entry'), className: `px-3 py-1 text-xs rounded ${activeTab==='entry'?'bg-slate-600':''}`}, "Giriş"),
                        React.createElement("button", {onClick: ()=>setActiveTab('history'), className: `px-3 py-1 text-xs rounded ${activeTab==='history'?'bg-slate-600':''}`}, "Geçmiş"),
                        React.createElement("button", {onClick: ()=>setActiveTab('sales'), className: `px-3 py-1 text-xs rounded ${activeTab==='sales'?'bg-purple-600 text-white':'text-purple-300'}`}, "Satış")
                    )
                ),

                React.createElement("main", {className: "max-w-md mx-auto p-4 space-y-4 no-print"},
                    // CNC SEKME İÇERİKLERİ ...
                    activeTab === 'entry' && React.createElement("div", {className: "space-y-6"},
                         React.createElement("div", {className: "grid grid-cols-3 gap-2"}, MACHINES.map(m => React.createElement("button", {key: m.id, onClick: ()=>setActiveMachine(m.id), className: `py-3 rounded-xl border-b-4 ${activeMachine===m.id ? m.color+' text-white' : 'bg-white'}`}, m.id))),
                         React.createElement("div", {className: "bg-white p-5 rounded-2xl shadow-sm border space-y-4"},
                            React.createElement("div", {}, React.createElement("label", {className: "text-xs font-bold text-gray-400"}, "PARÇA"), React.createElement("input", {list: "prods", value: partName, onChange: e=>setPartName(e.target.value), className: "w-full p-3 bg-slate-50 border rounded-xl font-bold uppercase", placeholder: "MİL-1"}), React.createElement("datalist", {id: "prods"}, uniqueProducts.map(p=>React.createElement("option", {key: p, value: p})))),
                            partName && React.createElement("div", {className: "grid grid-cols-3 gap-2 text-center bg-slate-50 p-3 rounded-xl"}, React.createElement("div", {}, React.createElement("div", {className:"text-[9px] text-gray-400"}, "BUGÜN"), React.createElement("div", {className:"font-bold"}, stats.daily)), React.createElement("div", {className:"text-blue-600"}, React.createElement("div", {className:"text-[9px]"}, "BU PARTİ"), React.createElement("div", {className:"font-bold text-lg"}, stats.batch)), React.createElement("div", {}, React.createElement("div", {className:"text-[9px] text-gray-400"}, "YIL"), React.createElement("div", {className:"font-bold"}, stats.yearly))),
                            React.createElement("div", {}, React.createElement("div", {className: "flex justify-between mb-1"}, React.createElement("label", {className: "text-xs font-bold text-gray-400"}, "MAKİNE SAYAÇ (TOPLAM)"), !isFirstRecordOfBatch && React.createElement("span", {className: "text-[10px] font-bold text-blue-600"}, "Önceki: " + lastCounterValue)), React.createElement("input", {type: "number", value: inputCounter, onChange: e=>setInputCounter(e.target.value), className: "w-full p-4 text-4xl font-bold text-center bg-slate-50 border rounded-xl", placeholder: "0", inputMode: "numeric"}), isFirstRecordOfBatch && inputCounter && React.createElement("div", {className: "text-xs text-center mt-2 text-yellow-600 font-bold"}, "Yeni Parti Başlangıcı")),
                            React.createElement("div", {className: "space-y-4"}, React.createElement("button", {onClick: handleSaveClick, className: `w-full py-4 rounded-xl text-white font-bold text-lg shadow-lg ${mConfig.color}`}, "KAYDET"), React.createElement("button", {onClick: handleFinishClick, className: "w-full py-4 bg-red-600 rounded-xl text-white font-bold text-lg shadow-lg"}, "KAYDET VE BİTİR"))
                         ),
                         yesterdaySummary.length > 0 && React.createElement("div", {className: "space-y-2"}, React.createElement("h3", {className: "text-xs font-bold text-slate-400 pl-2"}, "DÜNÜN ÖZETİ"), yesterdaySummary.map((sum, idx) => React.createElement("div", {key: idx, className: `bg-white p-3 rounded-xl border flex justify-between items-center shadow-sm ${sum.isFinished ? 'border-red-300 bg-red-50' : 'border-slate-200'}`}, React.createElement("div", {className: "flex items-center gap-3"}, React.createElement("div", {className: `text-[10px] font-bold text-white px-2 py-1 rounded ${sum.machineColor}`}, sum.machineId), React.createElement("div", {className: "text-sm font-bold text-slate-700"}, sum.partName)), React.createElement("div", {className: "text-right"}, React.createElement("div", {className: "text-sm font-bold text-green-600 flex items-center justify-end gap-1"}, sum.totalProduction + " Adet", sum.isFinished && React.createElement(IconFlag, {className: "text-red-600 w-4 h-4"})), React.createElement("div", {className: "text-sm font-bold text-gray-500"}, "Toplam (Sayaç): " + sum.lastCounter)))))
                    ),

                    activeTab === 'history' && React.createElement("div", {}, 
                        React.createElement("div", {className: "bg-white p-4 rounded-xl border mb-4"}, React.createElement("input", {type: "date", value: selectedHistoryDate, onChange: e=>setSelectedHistoryDate(e.target.value), className: "w-full p-2 border rounded-lg"})),
                        logs.filter(l=>l.date===selectedHistoryDate).map(l => { const mColor = MACHINES.find(m => m.id === l.machineId)?.color || 'bg-gray-500'; return React.createElement("div", {key: l.id, onClick: ()=>{setEditLog(l); setShowEditModal(true);}, className: `bg-white p-3 rounded-xl border mb-2 flex justify-between items-center cursor-pointer active:bg-slate-50 ${l.type==='finish'?'border-red-300 bg-red-50':''}`}, React.createElement("div", {}, React.createElement("span", {className: `text-xs font-bold text-white px-2 py-1 rounded mr-2 ${mColor}`}, l.machineId), React.createElement("span", {className: "font-bold"}, l.partName)), React.createElement("div", {className: "text-right"}, React.createElement("div", {className: "font-bold text-lg flex items-center justify-end gap-2"}, l.count, l.type === 'finish' && React.createElement("span", {className:"text-[10px] bg-red-600 text-white px-1 rounded flex items-center gap-1"}, "BİTTİ", React.createElement(IconFlag, {className:"w-3 h-3 text-white"}))), React.createElement("div", {className: "text-sm font-bold text-gray-500"}, "Toplam (Sayaç): " + (l.totalCounter || '-')))); })
                    ),

                    // --- 3. SATIŞ SEKME (GÜNCELLENMİŞ) ---
                    activeTab === 'sales' && React.createElement("div", {className: "space-y-4"},
                        
                        // YENİ SATIŞ BUTONU + RAPOR BUTONU
                        React.createElement("div", {className: "flex gap-2"},
                            React.createElement("button", {onClick: ()=>setIsSalesFormOpen(!isSalesFormOpen), className: "flex-1 py-3 bg-purple-600 text-white font-bold rounded-xl shadow-lg shadow-purple-200 active:scale-95 transition"}, isSalesFormOpen ? "GİRİŞİ KAPAT" : "+ YENİ SATIŞ GİRİŞİ"),
                            React.createElement("button", {onClick: ()=>setShowReportModal(true), className: "w-12 bg-white text-purple-600 border border-purple-100 rounded-xl flex items-center justify-center font-bold shadow-sm"}, React.createElement(IconChart))
                        ),

                        // YENİ SATIŞ KARTI (GİZLENEBİLİR)
                        isSalesFormOpen && React.createElement("div", {className: "bg-white p-4 rounded-2xl shadow-sm border border-purple-100 space-y-3 animate-fade-in"},
                            React.createElement("h2", {className: "text-xs font-bold text-purple-800 border-b border-purple-100 pb-1 mb-2"}, "SİPARİŞ DETAYLARI"),
                            React.createElement("div", {className: "flex gap-2"},
                                React.createElement("input", {type: "date", value: salesDate, onChange: e=>setSalesDate(e.target.value), className: "w-1/3 p-2 border rounded-lg font-bold text-sm"}),
                                React.createElement("input", {list: "customerList", value: customer, onChange: e=>setCustomer(e.target.value), placeholder: "Müşteri Adı", className: "w-2/3 p-2 border rounded-lg font-bold uppercase text-sm"}),
                                React.createElement("datalist", {id: "customerList"}, uniqueCustomers.map(c => React.createElement("option", {key: c, value: c})))
                            ),
                            React.createElement("div", {className: "bg-purple-50 p-3 rounded-xl border border-purple-100 space-y-2"},
                                React.createElement("input", {list: "salesProductList", value: product, onChange: e=>setProduct(e.target.value), placeholder: "Ürün Adı", className: "w-full p-2 border rounded-lg font-bold uppercase text-sm"}),
                                React.createElement("datalist", {id: "salesProductList"}, uniqueSalesProducts.map(p => React.createElement("option", {key: p, value: p}))),
                                React.createElement("div", {className: "flex gap-2"},
                                    React.createElement("input", {type: "number", value: count, onChange: e=>setCount(e.target.value), placeholder: "Adet", className: "w-1/3 p-2 border rounded-lg text-center font-bold text-sm"}),
                                    React.createElement("input", {type: "number", value: price, onChange: e=>setPrice(e.target.value), placeholder: "Fiyat", className: "w-1/3 p-2 border rounded-lg text-center font-bold text-sm"}),
                                    React.createElement("button", {onClick: handleAddToCart, className: "w-1/3 bg-purple-600 text-white rounded-lg font-bold text-xs"}, "EKLE")
                                ),
                                React.createElement("label", {className: "flex items-center gap-2 text-[10px] font-bold text-purple-700 mt-1"},
                                    React.createElement("input", {type: "checkbox", checked: taxIncluded, onChange: e=>setTaxIncluded(e.target.checked), className: "w-3 h-3 accent-purple-600"}), "KDV (%20) Ekle"
                                )
                            ),
                            cart.length > 0 && React.createElement("div", {},
                                cart.map(item => React.createElement("div", {key: item.id, className: "flex justify-between text-xs border-b border-slate-100 py-1"},
                                    React.createElement("span", {}, item.product + " (" + item.count + "x" + item.price + ")"),
                                    React.createElement("span", {className: "font-bold"}, item.total.toLocaleString('tr-TR') + "₺")
                                )),
                                React.createElement("div", {className: "flex justify-between items-center mt-3 pt-2 border-t border-purple-200"},
                                    React.createElement("span", {className: "font-bold text-purple-900"}, "TOPLAM"),
                                    React.createElement("span", {className: "text-xl font-bold text-purple-700"}, cart.reduce((a,i)=>a+i.total,0).toLocaleString('tr-TR')+"₺")
                                ),
                                React.createElement("button", {onClick: handleSaveSale, className: "w-full mt-3 py-3 bg-purple-700 text-white font-bold rounded-xl hover:bg-purple-800"}, "SATIŞI TAMAMLA")
                            )
                        ),

                        // ARAMA VE LİSTE (GÜNCELLENDİ: ÇİFT FİLTRE)
                        React.createElement("div", {className: "pt-2"},
                            React.createElement("div", {className: "flex gap-2 mb-4"},
                                React.createElement("div", {className: "relative flex-1"},
                                    React.createElement("input", {type: "text", value: searchTerm, onChange: e=>setSearchTerm(e.target.value), placeholder: "Müşteri Ara...", className: "w-full p-3 pl-9 border border-slate-300 rounded-xl shadow-sm focus:ring-2 focus:ring-purple-500 outline-none font-bold text-sm"}),
                                    React.createElement("div", {className: "absolute left-2.5 top-3.5"}, React.createElement(IconSearch))
                                ),
                                React.createElement("div", {className: "relative flex-1"},
                                    React.createElement("input", {type: "text", value: productSearchTerm, onChange: e=>setProductSearchTerm(e.target.value), placeholder: "Ürün Ara...", className: "w-full p-3 pl-9 border border-slate-300 rounded-xl shadow-sm focus:ring-2 focus:ring-purple-500 outline-none font-bold text-sm"}),
                                    React.createElement("div", {className: "absolute left-2.5 top-3.5"}, React.createElement(IconSearch))
                                )
                            ),
                            React.createElement("h2", {className: "font-bold text-slate-400 text-xs mb-3 px-1 uppercase tracking-wide"}, (searchTerm || productSearchTerm) ? "ARAMA SONUÇLARI" : "SON HAREKETLER"),
                            React.createElement("div", {className: "space-y-3"},
                                filteredSales.map(sale => 
                                    React.createElement("div", {key: sale.id, onClick: ()=>setEditingSale(sale), className: "bg-white p-4 rounded-xl border border-slate-200 shadow-sm active:bg-slate-50 cursor-pointer relative"},
                                        React.createElement("div", {className: "flex justify-between items-start"},
                                            React.createElement("div", {},
                                                React.createElement("div", {className: "font-bold text-slate-800 text-lg flex items-center gap-2"}, sale.customer),
                                                React.createElement("div", {className: "text-xs text-gray-400"}, new Date(sale.date).toLocaleDateString('tr-TR') + " • " + (sale.items?.length || 0) + " Kalem")
                                            ),
                                            React.createElement("div", {className: "text-right"},
                                                React.createElement("div", {className: "font-bold text-purple-600 text-lg"}, sale.grandTotal.toLocaleString('tr-TR', {minimumFractionDigits:2}) + "₺"),
                                                React.createElement("button", {onClick: (e)=> { e.stopPropagation(); handlePrint(sale); }, className: "bg-blue-50 text-blue-600 p-1.5 rounded-lg mt-1 inline-flex items-center gap-1 text-[10px] font-bold border border-blue-100"}, React.createElement(IconPrinter), "YAZDIR")
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
             );
        }
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>

